<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Syncify - Synchronized Music Player</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
      position: relative;
      overflow-x: hidden;
    }

    .animated-bg {
      position: fixed;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      z-index: -1;
      animation: rotate 20s linear infinite;
      background: conic-gradient(from 180deg at 50% 50%, #667eea 0deg, #764ba2 120deg, #f093fb 240deg, #667eea 360deg);
      opacity: 0.3;
    }

    @keyframes rotate {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      padding: 30px 0;
      animation: slideDown 0.8s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-size: 3em;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #fff, #f0f0f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .subtitle {
      font-size: 1.2em;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    .room-info {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeIn 1s ease-out 0.3s both;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .room-controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .room-input {
      padding: 12px 20px;
      border-radius: 30px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 16px;
      width: 250px;
      transition: all 0.3s;
    }

    .room-input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
    }

    .room-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .btn {
      padding: 12px 30px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .status {
      text-align: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .connected-devices {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .device-badge {
      padding: 8px 15px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      font-size: 14px;
      animation: popIn 0.3s ease-out;
    }

    @keyframes popIn {
      from {
        transform: scale(0);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .search-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeIn 1s ease-out 0.5s both;
    }

    .search-box {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      padding: 15px 20px;
      border-radius: 30px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 16px;
      transition: all 0.3s;
    }

    .search-input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.2);
    }

    .search-results {
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .search-results::-webkit-scrollbar {
      width: 8px;
    }

    .search-results::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .search-results::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
    }

    .song-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .song-item:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
    }

    .song-thumbnail {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
    }

    .song-info {
      flex: 1;
    }

    .song-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .song-channel {
      font-size: 14px;
      opacity: 0.8;
    }

    .player-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeIn 1s ease-out 0.7s both;
    }

    .now-playing {
      text-align: center;
      margin-bottom: 25px;
    }

    .now-playing-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .now-playing-artist {
      opacity: 0.8;
    }

    .player-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
    }

    .control-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      color: white;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .control-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .control-btn.play-btn {
      width: 80px;
      height: 80px;
      font-size: 32px;
    }

    .progress-bar {
      background: rgba(255, 255, 255, 0.2);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .progress {
      height: 100%;
      background: linear-gradient(90deg, #f093fb, #f5576c);
      width: 0%;
      transition: width 0.1s linear;
    }

    .time-display {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      opacity: 0.8;
    }

    .volume-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .volume-slider {
      width: 150px;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      border-radius: 50%;
      cursor: pointer;
    }

    .sync-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background: rgba(0, 255, 0, 0.2);
      border: 2px solid rgba(0, 255, 0, 0.5);
      border-radius: 30px;
      display: none;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .sync-indicator.active {
      display: block;
    }

    #youtube-player {
      position: absolute;
      top: -9999px;
      left: -9999px;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2em;
      }

      .room-controls {
        flex-direction: column;
        align-items: center;
      }

      .room-input {
        width: 100%;
      }

      .search-box {
        flex-direction: column;
      }

      .player-controls {
        gap: 15px;
      }

      .control-btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }

      .control-btn.play-btn {
        width: 70px;
        height: 70px;
        font-size: 28px;
      }
    }
  </style>
</head>

<body>
  <div class="animated-bg"></div>

  <div class="container">
    <div class="header">
      <h1>🎵 Syncify</h1>
      <p class="subtitle">Sync music across multiple devices in real-time</p>
    </div>

    <div class="room-info">
      <div class="room-controls">
        <input type="text" class="room-input" id="roomId" placeholder="Enter Room ID">
        <button class="btn" id="createRoom">Create Room</button>
        <button class="btn" id="joinRoom">Join Room</button>
      </div>
      <div class="status" id="status">Not connected to any room</div>
      <div class="connected-devices" id="connectedDevices"></div>
    </div>

    <div class="search-section" id="searchSection" style="display: none;">
      <h2 style="margin-bottom: 20px;">Search Music</h2>
      <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="Search for songs, artists, or albums...">
        <button class="btn" id="searchBtn">Search</button>
      </div>
      <div class="search-results" id="searchResults"></div>
    </div>

    <div class="player-section" id="playerSection" style="display: none;">
      <div class="now-playing">
        <div class="now-playing-title" id="nowPlayingTitle">No song playing</div>
        <div class="now-playing-artist" id="nowPlayingArtist">Select a song to start</div>
      </div>

      <div class="player-controls">
        <button class="control-btn" id="prevBtn">⏮</button>
        <button class="control-btn play-btn" id="playPauseBtn">▶</button>
        <button class="control-btn" id="nextBtn">⏭</button>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress" id="progress"></div>
      </div>

      <div class="time-display">
        <span id="currentTime">0:00</span>
        <span id="duration">0:00</span>
      </div>

      <div class="volume-control">
        <span>🔊</span>
        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
        <span id="volumeValue">70%</span>
      </div>
    </div>
  </div>

  <div class="sync-indicator" id="syncIndicator">Synced ✓</div>
  <div id="youtube-player"></div>

  <script>
    // Socket.io connection
    const socket = io();

    // YouTube IFrame API
    let player;
    let isPlayerReady = false;
    let currentVideoId = null;
    let syncInterval = null;
    let isMaster = false;
    let playlist = [];
    let currentTrackIndex = 0;

    // Load YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('youtube-player', {
        height: '0',
        width: '0',
        videoId: '',
        playerVars: {
          'autoplay': 0,
          'controls': 0,
          'disablekb': 1,
          'enablejsapi': 1,
          'modestbranding': 1,
          'origin': window.location.origin,
          'playsinline': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      isPlayerReady = true;
      console.log('YouTube player ready');
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        document.getElementById('playPauseBtn').innerHTML = '⏸';
        startProgressUpdate();
        if (isMaster) {
          socket.emit('sync-state', {
            room: socket.room,
            state: 'playing',
            videoId: currentVideoId,
            time: player.getCurrentTime()
          });
        }
      } else if (event.data === YT.PlayerState.PAUSED) {
        document.getElementById('playPauseBtn').innerHTML = '▶';
        stopProgressUpdate();
        if (isMaster) {
          socket.emit('sync-state', {
            room: socket.room,
            state: 'paused',
            videoId: currentVideoId,
            time: player.getCurrentTime()
          });
        }
      } else if (event.data === YT.PlayerState.ENDED) {
        playNext();
      }
    }

    // Room management
    document.getElementById('createRoom').addEventListener('click', () => {
      const roomId = document.getElementById('roomId').value || generateRoomId();
      socket.emit('create-room', roomId);
      isMaster = true;
    });

    document.getElementById('joinRoom').addEventListener('click', () => {
      const roomId = document.getElementById('roomId').value;
      if (roomId) {
        socket.emit('join-room', roomId);
        isMaster = false;
      } else {
        alert('Please enter a Room ID');
      }
    });

    function generateRoomId() {
      return Math.random().toString(36).substr(2, 6).toUpperCase();
    }

    // Socket event listeners
    socket.on('room-created', (data) => {
      socket.room = data.roomId;
      document.getElementById('roomId').value = data.roomId;
      document.getElementById('status').innerHTML = `Room created: ${data.roomId} | ${data.users} device(s) connected`;
      document.getElementById('searchSection').style.display = 'block';
      document.getElementById('playerSection').style.display = 'block';
      document.getElementById('syncIndicator').classList.add('active');
      updateConnectedDevices(data.users);
    });

    socket.on('room-joined', (data) => {
      socket.room = data.roomId;
      document.getElementById('status').innerHTML = `Joined room: ${data.roomId} | ${data.users} device(s) connected`;
      document.getElementById('searchSection').style.display = 'block';
      document.getElementById('playerSection').style.display = 'block';
      document.getElementById('syncIndicator').classList.add('active');
      updateConnectedDevices(data.users);
    });

    socket.on('user-joined', (data) => {
      updateConnectedDevices(data.users);
      if (isMaster && currentVideoId) {
        // Send current state to new user
        socket.emit('sync-state', {
          room: socket.room,
          state: player.getPlayerState() === YT.PlayerState.PLAYING ? 'playing' : 'paused',
          videoId: currentVideoId,
          time: player.getCurrentTime()
        });
      }
    });

    socket.on('user-left', (data) => {
      updateConnectedDevices(data.users);
    });

    socket.on('play-song', (data) => {
currentVideoId = data.videoId;
    // Preload video in paused state
    player.cueVideoById(data.videoId);
    document.getElementById('nowPlayingTitle').textContent = data.title;
    document.getElementById('nowPlayingArtist').textContent = data.channel;

    // Sync with host time
    const delay = data.startAt - Date.now();
    if (delay > 0) {
      // Preload, then play at exact moment
      setTimeout(() => {
        player.seekTo(0, true);
        player.playVideo();
      }, delay);
    } else {
      // If we’re late, catch up
      const elapsed = (Date.now() - data.startAt) / 1000;
      player.seekTo(elapsed, true);
      player.playVideo();
    }
  }
);

    socket.on('sync-state', (data) => {
      if (currentVideoId === data.videoId) {
        const timeDiff = Math.abs(player.getCurrentTime() - data.time);
        if (timeDiff > 0.3) {
          player.seekTo(data.time, true);
        }
        if (data.state === 'playing') {
          player.playVideo();
        } else {
          player.pauseVideo();
        }
      }
    });

    socket.on('control-action', (data) => {
      if (data.action === 'play') {
        player.playVideo();
      } else if (data.action === 'pause') {
        player.pauseVideo();
      } else if (data.action === 'seek') {
        player.seekTo(data.time, true);
      }
    });

    function updateConnectedDevices(count) {
      const container = document.getElementById('connectedDevices');
      container.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const badge = document.createElement('div');
        badge.className = 'device-badge';
        badge.innerHTML = `📱 Device ${i + 1}`;
        container.appendChild(badge);
      }
    }

    // Search functionality
    document.getElementById('searchBtn').addEventListener('click', searchMusic);
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchMusic();
    });

    async function searchMusic() {
      const query = document.getElementById('searchInput').value;
      if (!query) return;

      const searchResults = document.getElementById('searchResults');
      searchResults.innerHTML = '<div class="loading"></div>';

      // YouTube Data API v3 - You need to get your own API key
      const API_KEY = 'AIzaSyAa8cESXjlCxMEcyMIYje7VLfXI1rqgYLY';

      // Actual YouTube API implementation:
      try {
          const response = await fetch(
              `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}`
          );
          const data = await response.json();
          displaySearchResults(data.items);
      } catch (error) {
          console.error('Search error:', error);
          searchResults.innerHTML = '<p>Error searching for songs. Please try again.</p>';
      }
      
    }

    function displaySearchResults(items) {
      const searchResults = document.getElementById('searchResults');
      searchResults.innerHTML = '';

      items.forEach(item => {
        const songItem = document.createElement('div');
        songItem.className = 'song-item';
        songItem.innerHTML = `
                    <img src="${item.snippet.thumbnails.default.url}" alt="${item.snippet.title}" class="song-thumbnail">
                    <div class="song-info">
                        <div class="song-title">${item.snippet.title}</div>
                        <div class="song-channel">${item.snippet.channelTitle}</div>
                    </div>
                `;
        songItem.addEventListener('click', () => {
          loadAndPlayVideo(item.id.videoId, item.snippet.title, item.snippet.channelTitle);
          playlist.push(item);

          // Emit to other devices
          socket.emit('play-song', {
            room: socket.room,
            videoId: item.id.videoId,
            title: item.snippet.title,
            channel: item.snippet.channelTitle,
            startAt: Date.now() + 200
          });
        });
        searchResults.appendChild(songItem);
      });
    }

    function loadAndPlayVideo(videoId, title, channel) {
      if (!isPlayerReady) {
        console.log('Player not ready yet');
        return;
      }

      currentVideoId = videoId;
      player.loadVideoById(videoId);
      document.getElementById('nowPlayingTitle').textContent = title;
      document.getElementById('nowPlayingArtist').textContent = channel;
    }

    // Player controls
    document.getElementById('playPauseBtn').addEventListener('click', () => {
      if (!currentVideoId) return;

      if (player.getPlayerState() === YT.PlayerState.PLAYING) {
        player.pauseVideo();
        socket.emit('control-action', { room: socket.room, action: 'pause' });
      } else {
        player.playVideo();
        socket.emit('control-action', { room: socket.room, action: 'play' });
      }
    });

    document.getElementById('prevBtn').addEventListener('click', playPrevious);
    document.getElementById('nextBtn').addEventListener('click', playNext);

    function playPrevious() {
      if (currentTrackIndex > 0) {
        currentTrackIndex--;
        const track = playlist[currentTrackIndex];
        loadAndPlayVideo(track.id.videoId, track.snippet.title, track.snippet.channelTitle);
      }
    }

    function playNext() {
      if (currentTrackIndex < playlist.length - 1) {
        currentTrackIndex++;
        const track = playlist[currentTrackIndex];
        loadAndPlayVideo(track.id.videoId, track.snippet.title, track.snippet.channelTitle);
      }
    }

    // Progress bar
    let progressInterval;

    function startProgressUpdate() {
      stopProgressUpdate();
      progressInterval = setInterval(updateProgress, 100);
    }

    function stopProgressUpdate() {
      if (progressInterval) {
        clearInterval(progressInterval);
      }
    }

    function updateProgress() {
      if (player && player.getCurrentTime) {
        const currentTime = player.getCurrentTime();
        const duration = player.getDuration();
        const progress = (currentTime / duration) * 100;

        document.getElementById('progress').style.width = progress + '%';
        document.getElementById('currentTime').textContent = formatTime(currentTime);
        document.getElementById('duration').textContent = formatTime(duration);
      }
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    document.getElementById('progressBar').addEventListener('click', (e) => {
      if (!player || !player.getDuration) return;

      const rect = e.currentTarget.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const width = rect.width;
      const duration = player.getDuration();
      const newTime = (clickX / width) * duration;
      player.seekTo(newTime, true);
      socket.emit('control-action', { room: socket.room, action: 'seek', time: newTime });
    });

    // Volume control
    document.getElementById('volumeSlider').addEventListener('input', (e) => {
        const volume = e.target.value;
        player.setVolume(volume);
        document.getElementById('volumeValue').textContent = `${volume}%`;
    });

    // Initialize volume
    if (player) {
        player.setVolume(document.getElementById('volumeSlider').value);
    } else {
        // If player is not ready yet, set a default volume and update when ready
        document.getElementById('volumeValue').textContent = `${document.getElementById('volumeSlider').value}%`;
    }

</script>
</body>

</html>




